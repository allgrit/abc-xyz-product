<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Сайт в разработке — ABC/XYZ анализ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Стили -->
  <link rel="stylesheet" href="./css/styles.css" />

  <!-- Библиотека для чтения Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>

  <!-- Скрипты сайта -->
  <script src="./js/abc-xyz-treemap.js" defer></script>
  <script src="./js/abc-xyz.js" defer></script>
</head>
<body>
  <div class="page">
    <header>
      <div class="pill">
        <span class="dot"></span>
        <span>Сайт в разработке</span>
      </div>
      <h1>blink182allgrit • мини-лаборатория</h1>
      <p>Основной проект ещё собирается, но здесь уже доступны демо-утилиты и визуализации.</p>
      <div class="nav-links">
        <a href="/games.html">Мини-игры</a>
        <a href="/about.html">О проекте</a>
        <a href="/status.html">Статус системы</a>
      </div>
    </header>

    <div class="layout">
      <section class="card">
        <h2>Доступные демо</h2>
        <p>На этой заглушке можно загрузить Excel и посмотреть ABC/XYZ анализ, а мини-игры переехали на отдельную страницу.</p>
        <p>Выберите, что интересно прямо сейчас: запустить симуляции или перейти к разбору данных.</p>

        <div class="btn-row">
          <a class="link-button" href="/games.html">Играть в мини-игры</a>
          <a class="link-button secondary" href="#abc-section">Открыть ABC/XYZ анализ</a>
        </div>
      </section>

      <aside class="card">
        <h2>Что здесь будет позже</h2>
        <p>Сейчас это заглушка для сервера, на котором настраивается инфраструктура и сервисы. В будущем здесь может появиться:</p>
        <ul class="meta-list">
          <li>• главная страница проекта с описанием сервиса;</li>
          <li>• раздел для документации и инструкций;</li>
          <li>• статус-страница сервисов и мониторинг;</li>
          <li>• дополнительные мини-игры и технические демо.</li>
        </ul>
        <p style="margin-top:14px;">
          Пока основная часть строится, можно опробовать мини-игры на отдельной странице или загрузить свои данные для ABC/XYZ анализа прямо ниже.
        </p>
      </aside>
    </div>

    <!-- ABC / XYZ -->
    <section id="abc-section" class="card" style="margin-top: 20px;">
      <h2>ABC / XYZ анализ продаж</h2>
      <p style="font-size: 14px; color: #d1d5db; margin-bottom: 10px;">
        Загрузите Excel-файл с историей продаж (XLS/XLSX), выберите колонки и получите
        матрицу ABC/XYZ и таблицу по SKU. Все расчёты выполняются в браузере.
      </p>

      <div id="abcError" style="font-size: 13px; color: #f97316; margin-bottom: 6px;"></div>

      <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 10px;">
        <div style="flex: 1 1 260px; min-width: 0;">
          <label style="font-size: 13px; color: #e5e7eb; display: block; margin-bottom: 6px;">
            Файл с данными (.xls, .xlsx, .csv)
          </label>
          <input id="abcFileInput" type="file" accept=".xls,.xlsx,.csv"
                 style="width: 100%; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(148,163,184,0.6); background: #020617; color: #e5e7eb; font-size: 13px;" />
          <div id="abcFileInfo" style="margin-top: 6px; font-size: 12px; color: #9ca3af;"></div>

          <div style="margin-top: 10px; display: flex; gap: 8px; align-items: center;">
            <button id="abcDemoBtn"
                    style="flex: 0 0 auto; border: none; border-radius: 999px; padding: 6px 12px; font-size: 13px; cursor: pointer; background: rgba(59,130,246,0.15); color: #60a5fa; font-weight: 500;">
              ⚡ Загрузить демо-данные
            </button>
            <span style="font-size: 12px; color: #6b7280;">Можно сразу посмотреть ABC/XYZ на тестовом наборе.</span>
          </div>

          <div style="margin-top: 10px;">
            <div style="font-size: 12px; color: #9ca3af; margin-bottom: 4px;">Превью данных (первые строки):</div>
            <div id="abcPreviewWrapper" style="max-height: 180px; overflow: auto; border-radius: 10px; border: 1px solid rgba(55,65,81,0.9); background: rgba(15,23,42,0.7);">
              <table id="abcPreviewTable" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <div style="flex: 0 0 260px;">
          <div style="font-size: 13px; color: #e5e7eb; margin-bottom: 6px;">Мэппинг колонок</div>

          <label style="display: block; font-size: 12px; color: #9ca3af; margin-top: 4px;">SKU</label>
          <select id="abcSkuSelect" style="width: 100%; padding: 5px 10px; border-radius: 999px; border: 1px solid rgba(148,163,184,0.6); background: #020617; color: #e5e7eb; font-size: 13px;">
            <option value="">— выбрать колонку —</option>
          </select>

          <label style="display: block; font-size: 12px; color: #9ca3af; margin-top: 6px;">Дата продажи</label>
          <select id="abcDateSelect" style="width: 100%; padding: 5px 10px; border-radius: 999px; border: 1px solid rgba(148,163,184,0.6); background: #020617; color: #e5e7eb; font-size: 13px;">
            <option value="">— выбрать колонку —</option>
          </select>

          <label style="display: block; font-size: 12px; color: #9ca3af; margin-top: 6px;">Объём продажи</label>
          <select id="abcQtySelect" style="width: 100%; padding: 5px 10px; border-radius: 999px; border: 1px solid rgba(148,163,184,0.6); background: #020617; color: #e5e7eb; font-size: 13px;">
            <option value="">— выбрать колонку —</option>
          </select>

          <div style="margin-top: 10px; font-size: 12px; color: #6b7280;">
            Период для XYZ: <span style="color:#e5e7eb;">месяц</span>. ABC по сумме объёма за период.
          </div>

          <div style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap;">
            <button id="abcRunBtn" style="flex: 1 1 140px; border: none; border-radius: 999px; padding: 8px 14px; font-size: 14px; cursor: pointer; background: #3b82f6; color: #0b1120; font-weight: 500; box-shadow: 0 10px 25px rgba(37,99,235,0.5);">
              ▶ Запустить анализ
            </button>
            <button id="abcClearBtn" style="flex: 0 0 auto; border-radius: 999px; padding: 8px 14px; font-size: 13px; cursor: pointer; background: rgba(15,23,42,0.9); color: #e5e7eb; border: 1px solid rgba(148,163,184,0.6);">
              Очистить
            </button>
          </div>

          <div id="abcStatus" style="margin-top: 6px; font-size: 12px; color: #9ca3af;"></div>
        </div>
      </div>

      <div class="abc-view-tabs" role="tablist">
        <button class="abc-view-tab active" data-view="analysis">Анализ ABC / XYZ</button>
        <button class="abc-view-tab" data-view="forecast">Прогнозирование спроса</button>
      </div>

      <div class="abc-view active" data-view="analysis">
        <div style="margin-top: 6px; font-size: 13px; color: #e5e7eb;">Матрица ABC / XYZ</div>
        <div id="abcMatrixWrapper" style="margin-top: 4px; overflow-x: auto;">
          <table id="abcMatrixTable" style="border-collapse: collapse; font-size: 12px; min-width: 320px;">
            <thead>
              <tr>
                <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9);"></th>
                <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;">X (стабильный)</th>
                <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;">Y (умеренный)</th>
                <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;">Z (нестабильный)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:left;">A</th>
                <td data-cell="AX" style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;"></td>
                <td data-cell="AY" style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;"></td>
                <td data-cell="AZ" style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;"></td>
              </tr>
              <tr>
                <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:left;">B</th>
                <td data-cell="BX" style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;"></td>
                <td data-cell="BY" style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;"></td>
                <td data-cell="BZ" style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;"></td>
              </tr>
              <tr>
                <th style="padding: 6px 8px; text-align:left;">C</th>
                <td data-cell="CX" style="padding: 6px 8px; text-align:center;"></td>
                <td data-cell="CY" style="padding: 6px 8px; text-align:center;"></td>
                <td data-cell="CZ" style="padding: 6px 8px; text-align:center;"></td>
              </tr>
            </tbody>
          </table>
        </div>

        <div id="abcSummary" style="margin-top: 8px; font-size: 12px; color: #9ca3af;"></div>

        <div style="margin-top: 12px; font-size: 13px; color: #e5e7eb; margin-bottom: 6px;">Treemap по SKU (кликните «Прочие», чтобы раскрыть вложенные уровни)</div>
        <div id="abcTreemap" class="treemap" aria-label="Treemap по SKU">
          <div class="treemap-empty">Здесь появится визуализация после запуска анализа.</div>
        </div>
        <div class="treemap-legend">
          <span><span class="legend-dot legend-dot-x"></span> X — стабильный спрос</span>
          <span><span class="legend-dot legend-dot-y"></span> Y — умеренный спрос</span>
          <span><span class="legend-dot legend-dot-z"></span> Z — нестабильный спрос</span>
        </div>

        <div class="scatter-card" id="abcScatter">
          <div class="scatter-header">
            <div>
              <div class="scatter-title">Распределение SKU на матрице ABC/XYZ</div>
              <div class="scatter-subtitle">По горизонтали — накопленная доля продаж, по вертикали — коэффициент вариации (CoV).</div>
            </div>
            <div class="scatter-legend">
              <div>
                <div class="legend-label">Форма → ABC</div>
                <span class="legend-item"><span class="legend-shape legend-shape--triangle"></span>A</span>
                <span class="legend-item"><span class="legend-shape legend-shape--square"></span>B</span>
                <span class="legend-item"><span class="legend-shape legend-shape--circle"></span>C</span>
              </div>
              <div>
                <div class="legend-label">Цвет → XYZ</div>
                <span class="legend-item"><span class="legend-dot legend-dot-x"></span>X</span>
                <span class="legend-item"><span class="legend-dot legend-dot-y"></span>Y</span>
                <span class="legend-item"><span class="legend-dot legend-dot-z"></span>Z</span>
              </div>
            </div>
          </div>
          <div class="scatter-plot-wrapper">
            <svg id="abcScatterSvg" viewBox="0 0 640 360" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Scatter chart ABC/XYZ"></svg>
            <div class="scatter-empty">Запустите анализ, чтобы увидеть диаграмму рассеяния.</div>
          </div>
        </div>

        <div style="margin-top: 10px;">
          <div style="font-size: 13px; color: #e5e7eb; margin-bottom: 4px;">Таблица по SKU</div>
          <div id="abcResultWrapper" style="max-height: 260px; overflow: auto; border-radius: 10px; border: 1px solid rgba(55,65,81,0.9); background: rgba(15,23,42,0.7);">
            <table id="abcResultTable" style="width: 100%; border-collapse: collapse; font-size: 12px;">
              <thead>
                <tr>
                  <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:left;">SKU</th>
                  <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:right;">Итоговый объём</th>
                  <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;">ABC</th>
                  <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:center;">XYZ</th>
                  <th style="padding: 6px 8px; border-bottom: 1px solid rgba(55,65,81,0.9); text-align:right;">CoV</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="abc-view" data-view="forecast">
        <p class="forecast-lead">Собранные данные можно использовать для построения прогноза спроса. Выберите SKU и алгоритм, чтобы получить кривую на несколько месяцев вперёд.</p>

        <div class="forecast-config">
          <label>
            <span>SKU для прогнозирования</span>
            <select id="forecastSkuSelect">
              <option value="">— выберите SKU после загрузки данных —</option>
            </select>
          </label>
          <label>
            <span>Модель</span>
            <select id="forecastModelSelect">
              <option value="ma">Скользящее среднее</option>
              <option value="holt">Хольт — Винтерс</option>
              <option value="arima">ARIMA (ARIMA(1,1,0))</option>
              <option value="trend">Линейный тренд</option>
            </select>
          </label>
          <label>
            <span>Горизонт прогноза, мес.</span>
            <input id="forecastHorizonInput" type="number" min="1" max="18" value="6" />
          </label>
          <label>
            <span>Окно MA / сезонность</span>
            <input id="forecastWindowInput" type="number" min="2" max="12" value="3" />
          </label>
        </div>

        <div class="forecast-actions">
          <button id="forecastRunBtn">Построить прогноз</button>
          <div class="forecast-hint">Модели используют месячные суммы продаж. При смене SKU достаточно повторно нажать кнопку — файл заново загружать не нужно.</div>
        </div>

        <div id="forecastStatus" class="forecast-status">Загрузите данные и запустите анализ, чтобы открыть список SKU.</div>

        <div class="forecast-chart" id="forecastChartWrapper">
          <svg id="forecastChart" viewBox="0 0 640 280" role="img" aria-label="График прогноза"></svg>
          <div class="forecast-chart-empty">Постройте прогноз, чтобы увидеть график.</div>
        </div>

        <div class="forecast-table">
          <div class="forecast-table-title">История и прогноз по выбранному SKU</div>
          <div id="forecastResultWrapper">
            <table id="forecastResultTable">
              <thead>
                <tr>
                  <th>Период</th>
                  <th>Факт</th>
                  <th>Прогноз</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

  </div>
</body>
</html>
